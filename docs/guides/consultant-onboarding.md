# Guia de Onboarding do Consultor

## ğŸ¯ Objetivo

Permitir que consultores de planos de saÃºde **conectem sua prÃ³pria conta WhatsApp** Ã  plataforma Consultor.AI.

## ğŸ“Š Fluxo Visual Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASSO 1: Consultor cria conta na plataforma                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Consultor acessa: https://consultor.ai/signup
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  FormulÃ¡rio Signup   â”‚
              â”‚                      â”‚
              â”‚  Nome: JoÃ£o Silva    â”‚
              â”‚  Email: joao@ex.com  â”‚
              â”‚  Senha: ********     â”‚
              â”‚  Plano: Freemium     â”‚
              â”‚                      â”‚
              â”‚  [Criar Conta]       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Conta criada! âœ“      â”‚
              â”‚ Email verificado     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Dashboard vazio     â”‚
              â”‚                      â”‚
              â”‚  âš ï¸  Conecte seu     â”‚
              â”‚  WhatsApp para       â”‚
              â”‚  comeÃ§ar             â”‚
              â”‚                      â”‚
              â”‚  [Conectar WhatsApp] â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASSO 2: Consultor cria conta no provedor WhatsApp         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Consultor acessa: https://weni.ai
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Weni Cloud Signup   â”‚
              â”‚                      â”‚
              â”‚  - Cria conta        â”‚
              â”‚  - Verifica empresa  â”‚
              â”‚  - Conecta WhatsApp  â”‚
              â”‚    Business          â”‚
              â”‚  - Verifica nÃºmero   â”‚
              â”‚                      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ NÃºmero verificado âœ“  â”‚
              â”‚ +5561982809595       â”‚
              â”‚                      â”‚
              â”‚ API Key gerada:      â”‚
              â”‚ weni_abc123def456    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASSO 3: Consultor conecta WhatsApp na plataforma          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

Volta para: https://consultor.ai/dashboard
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Conectar WhatsApp    â”‚
              â”‚                      â”‚
              â”‚ Provedor:            â”‚
              â”‚ â—‹ Weni Cloud âœ“       â”‚
              â”‚ â—‹ 360dialog          â”‚
              â”‚ â—‹ Twilio             â”‚
              â”‚                      â”‚
              â”‚ API Key:             â”‚
              â”‚ [weni_abc123def456]  â”‚
              â”‚                      â”‚
              â”‚ Telefone:            â”‚
              â”‚ [+5561982809595]     â”‚
              â”‚                      â”‚
              â”‚ [Conectar]           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ âœ“ Validado e salvo (encrypted)       â”‚
              â”‚                                      â”‚
              â”‚ Configure webhook na Weni:           â”‚
              â”‚                                      â”‚
              â”‚ URL:                                 â”‚
              â”‚ https://consultor.ai/api/webhook/    â”‚
              â”‚       whatsapp/uuid-joao             â”‚
              â”‚                                      â”‚
              â”‚ Secret:                              â”‚
              â”‚ whsec_abc123def456ghi789             â”‚
              â”‚                                      â”‚
              â”‚ [Copiar URL] [Copiar Secret]         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ [JÃ¡ configurei]      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASSO 4: Consultor configura webhook na Weni               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Volta para: https://weni.ai/dashboard
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Settings â†’ Webhooks â†’ Add Webhook   â”‚
              â”‚                                      â”‚
              â”‚ Webhook URL:                         â”‚
              â”‚ [https://consultor.ai/api/webhook/   â”‚
              â”‚  whatsapp/uuid-joao]                 â”‚
              â”‚                                      â”‚
              â”‚ Webhook Secret:                      â”‚
              â”‚ [whsec_abc123def456ghi789]           â”‚
              â”‚                                      â”‚
              â”‚ Events:                              â”‚
              â”‚ â˜‘ message.received                   â”‚
              â”‚ â˜‘ message.status                     â”‚
              â”‚                                      â”‚
              â”‚ [Save Webhook]                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Webhook ativo âœ“      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASSO 5: Teste de conexÃ£o                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Volta para: https://consultor.ai/dashboard
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ [Enviar Teste]       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Plataforma envia mensagem teste      â”‚
              â”‚ usando API Key do consultor          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ âœ“ Teste enviado!     â”‚
              â”‚                      â”‚
              â”‚ Verifique seu        â”‚
              â”‚ WhatsApp             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTADO: Sistema funcionando                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Lead envia mensagem â†’ WhatsApp do consultor (+5561982...)
                         â†“
      WhatsApp API (Weni - conta do consultor)
                         â†“
      POST https://consultor.ai/api/webhook/whatsapp/uuid-joao
                         â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Plataforma Consultor.AI             â”‚
      â”‚                                     â”‚
      â”‚ 1. Identifica consultor (uuid-joao) â”‚
      â”‚ 2. Busca credenciais (decrypted)    â”‚
      â”‚ 3. Processa com IA (Gemini)         â”‚
      â”‚ 4. Gera resposta personalizada      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
      Envia resposta usando API do consultor
                   â†“
      WhatsApp do consultor responde ao lead
                   â†“
      Lead recebe resposta automÃ¡tica âœ“
```

## ğŸ’¾ O que fica salvo no banco

```sql
-- Tabela: consultants
id: uuid-joao
name: JoÃ£o Silva
email: joao@example.com
tier: freemium
created_at: 2025-12-15

-- Tabela: whatsapp_integrations
id: uuid-integration-123
consultant_id: uuid-joao
provider: weni
api_key: [ENCRYPTED] iv:tag:ciphertext
webhook_secret: [ENCRYPTED] iv:tag:ciphertext
phone_number: +5561982809595
status: active
verified_at: 2025-12-15
```

## ğŸ” SeguranÃ§a

### API Keys sÃ£o criptografadas

```typescript
// Antes de salvar
const plainApiKey = "weni_abc123def456"
const encryptedApiKey = encrypt(plainApiKey)
// Resultado: "a1b2c3:d4e5f6:g7h8i9..."

// Salva no banco
await db.insert({ api_key: encryptedApiKey })

// Quando precisa usar
const { api_key } = await db.findOne(...)
const plainApiKey = decrypt(api_key)
// Resultado: "weni_abc123def456"

// Usa para fazer chamada
await weniClient.sendMessage(plainApiKey, ...)
```

### Webhook validation

```typescript
// Cada requisiÃ§Ã£o Ã© validada
const signature = req.headers['x-webhook-signature']
const expectedSignature = hmac(webhookSecret, body)

if (signature !== expectedSignature) {
  throw new Error('Invalid webhook signature')
}
```

## ğŸ¨ UI/UX do Dashboard

### Tela: Conectar WhatsApp

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conectar WhatsApp Business                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ Passo 1: Escolha seu provedor                         â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚    Weni    â”‚  â”‚ 360dialog  â”‚  â”‚   Twilio   â”‚       â”‚
â”‚ â”‚   Cloud    â”‚  â”‚            â”‚  â”‚            â”‚       â”‚
â”‚ â”‚            â”‚  â”‚            â”‚  â”‚            â”‚       â”‚
â”‚ â”‚ Recomendadoâ”‚  â”‚   Popular  â”‚  â”‚  AvanÃ§ado  â”‚       â”‚
â”‚ â”‚            â”‚  â”‚            â”‚  â”‚            â”‚       â”‚
â”‚ â”‚ [Selecionarâ”‚  â”‚ [Selecionarâ”‚  â”‚ [Selecionarâ”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ Passo 2: Configure sua conta Weni                     â”‚
â”‚                                                        â”‚
â”‚ Ainda nÃ£o tem conta na Weni?                          â”‚
â”‚ [Criar conta grÃ¡tis â†’]                                â”‚
â”‚                                                        â”‚
â”‚ JÃ¡ tem conta? Siga os passos:                         â”‚
â”‚                                                        â”‚
â”‚ 1. Acesse weni.ai e faÃ§a login                        â”‚
â”‚ 2. VÃ¡ em Settings â†’ API Keys                          â”‚
â”‚ 3. Clique em "Generate New Key"                       â”‚
â”‚ 4. Copie a API Key gerada                             â”‚
â”‚ 5. Cole abaixo                                         â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ Passo 3: Cole suas credenciais                        â”‚
â”‚                                                        â”‚
â”‚ API Key *                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ weni_abc123def456ghi789jkl012                  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚ NÃºmero de WhatsApp *                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ +55 61 98280-9595                              â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚ â˜ Li e aceito que minhas credenciais serÃ£o            â”‚
â”‚   armazenadas de forma criptografada                  â”‚
â”‚                                                        â”‚
â”‚              [Conectar WhatsApp]                       â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela: Configurar Webhook (apÃ³s conectar)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ WhatsApp conectado com sucesso!                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ Ãšltimo passo: Configure o webhook na Weni             â”‚
â”‚                                                        â”‚
â”‚ 1. Acesse weni.ai/dashboard                           â”‚
â”‚ 2. VÃ¡ em Settings â†’ Webhooks                          â”‚
â”‚ 3. Clique em "Add Webhook"                            â”‚
â”‚ 4. Cole as informaÃ§Ãµes abaixo:                        â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Webhook URL                                    â”‚    â”‚
â”‚ â”‚ https://consultor.ai/api/webhook/whatsapp/...  â”‚    â”‚
â”‚ â”‚                                      [Copiar]  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Webhook Secret                                 â”‚    â”‚
â”‚ â”‚ whsec_abc123def456ghi789jkl012mno345pqr678     â”‚    â”‚
â”‚ â”‚                                      [Copiar]  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚ 5. Marque os eventos:                                 â”‚
â”‚    â˜‘ message.received                                 â”‚
â”‚    â˜‘ message.status                                   â”‚
â”‚                                                        â”‚
â”‚ 6. Salve o webhook                                    â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ âš ï¸  Importante: NÃ£o compartilhe estas          â”‚    â”‚
â”‚ â”‚    informaÃ§Ãµes com terceiros                   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚         [JÃ¡ configurei] [Preciso de ajuda]            â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela: Dashboard (apÃ³s conectar)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard - JoÃ£o Silva                    [Freemium]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ WhatsApp: âœ“ Conectado                                 â”‚
â”‚ +55 61 98280-9595 (Weni Cloud)                        â”‚
â”‚ Status: Ativo | Ãšltima msg: hÃ¡ 2 minutos              â”‚
â”‚ [Testar] [Desconectar]                                â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ Leads este mÃªs: 8/20 (Freemium)                       â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Maria Silva          +5561999887766  HÃ¡ 5min     â”‚  â”‚
â”‚ â”‚ "Quero informaÃ§Ãµes sobre plano de saÃºde"         â”‚  â”‚
â”‚ â”‚ â†’ Bot respondeu automaticamente                  â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ Pedro Santos         +5561988776655  HÃ¡ 15min    â”‚  â”‚
â”‚ â”‚ "Qual o valor do plano?"                         â”‚  â”‚
â”‚ â”‚ â†’ Bot respondeu automaticamente                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚              [Ver todos os leads]                      â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Fluxo TÃ©cnico (Backend)

### 1. Consultor conecta WhatsApp

```typescript
// POST /api/consultants/connect-whatsapp
{
  provider: "weni",
  apiKey: "weni_abc123def456",
  phoneNumber: "+5561982809595"
}

â†“

// Backend processa
const consultantId = await getAuthUser()
const encryptedApiKey = encrypt(apiKey)
const webhookSecret = generateSecret()
const encryptedSecret = encrypt(webhookSecret)

await db.insert('whatsapp_integrations', {
  consultant_id: consultantId,
  provider: 'weni',
  api_key: encryptedApiKey,
  webhook_secret: encryptedSecret,
  phone_number: phoneNumber,
  status: 'active'
})

â†“

// Retorna para frontend
{
  success: true,
  webhookUrl: `https://consultor.ai/api/webhook/whatsapp/${consultantId}`,
  webhookSecret: webhookSecret  // Sem criptografar (para configurar na Weni)
}
```

### 2. Lead envia mensagem

```typescript
// POST /api/webhook/whatsapp/[consultantId]
// Headers: { x-webhook-signature: "..." }
// Body: { from: "+5561999887766", text: "OlÃ¡" }

â†“

// Backend processa
const consultantId = params.consultantId

// 1. Valida signature
const integration = await db.findOne('whatsapp_integrations', { consultant_id })
const decryptedSecret = decrypt(integration.webhook_secret)
const isValid = validateSignature(body, signature, decryptedSecret)

// 2. Salva mensagem
await db.insert('messages', {
  consultant_id: consultantId,
  lead_phone: body.from,
  content: body.text,
  direction: 'inbound'
})

// 3. Gera resposta com IA
const response = await generateAIResponse({
  consultantId,
  message: body.text
})

// 4. Envia usando API do consultor
const decryptedApiKey = decrypt(integration.api_key)
const weniClient = new WeniClient(decryptedApiKey)
await weniClient.sendMessage(body.from, response)

// 5. Salva resposta
await db.insert('messages', {
  consultant_id: consultantId,
  lead_phone: body.from,
  content: response,
  direction: 'outbound'
})

return { success: true }
```

## ğŸ“š Documentos Relacionados

- `docs/architecture/Multi-Tenant-Architecture.md` - Arquitetura completa
- `docs/architecture/Database-Design-Document.md` - Schema do banco
- `docs/api/API-Specification.md` - Endpoints da API

## âœ… Checklist de ImplementaÃ§Ã£o

- [ ] Criar tabela `whatsapp_integrations`
- [ ] Implementar funÃ§Ãµes de criptografia
- [ ] Criar endpoint POST `/api/consultants/connect-whatsapp`
- [ ] Criar endpoint POST `/api/webhook/whatsapp/[consultantId]`
- [ ] Criar UI de conexÃ£o WhatsApp
- [ ] Implementar validaÃ§Ã£o de webhook
- [ ] Criar cliente Weni
- [ ] Criar cliente 360dialog
- [ ] Criar cliente Twilio
- [ ] Testes de integraÃ§Ã£o
- [ ] DocumentaÃ§Ã£o para consultores
